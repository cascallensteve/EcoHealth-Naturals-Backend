Product API (Admin-Only)

Overview
--------
The Product API manages products in the system.

- Framework: Django REST Framework
- Base URL: /api/products/products/
- Access: Admin users only
- Model: product.models.Product

Only authenticated users with is_staff = True can access these endpoints.
Non-admin users receive 403 Forbidden.

Authentication
--------------
The API uses the projectâ€™s existing authentication (session or token).

- Browsable API: log in as an admin user from the top-right login link.
- Programmatic clients (Postman, frontend, etc.):
  - Send the appropriate authentication headers (for example: Authorization: Token <token>).

Data Model
----------
Each product has the following fields (as exposed by the API):

- id (read-only, integer)
- name (string, required)
- description (string, required)
- price (decimal, required)
- amount (integer, required, stock quantity)
- category (integer, required, foreign key to Category ID)
- is_available (boolean, default: true)
- demand (string, one of: "low", "medium", "high")
- image_url (string, optional, URL)
- created_at (read-only, datetime)
- updated_at (read-only, datetime)

Endpoints
---------
Base path for all endpoints:

- /api/products/products/

1. List Products
----------------
Request
- Method: GET
- URL: /api/products/products/

Access
- Admin only.

Response (200 OK)
[ 
  {
    "id": 1,
    "name": "Vitamin C 500mg",
    "description": "Immune support supplement",
    "price": "19.99",
    "amount": 100,
    "category": 1,
    "is_available": true,
    "demand": "high",
    "image_url": "https://example.com/vitamin-c.jpg",
    "created_at": "2025-12-11T06:40:00Z",
    "updated_at": "2025-12-11T06:45:00Z"
  }
]

2. Retrieve a Single Product
----------------------------
Request
- Method: GET
- URL: /api/products/products/<id>/
- Example: /api/products/products/1/

Access
- Admin only.

Response
- 200 OK with a single product object.
- 404 Not Found if the product does not exist.

3. Create or Update (Upsert) Product
------------------------------------
This endpoint has special behavior:
It uses (name, category) as a unique key to avoid duplicates.

- If a product with the same name and category does not exist
  -> a new one is created (201 Created).
- If such a product already exists
  -> that product is updated with the submitted data (200 OK).

Request
- Method: POST
- URL: /api/products/products/

Request body
{
  "name": "Vitamin C 500mg",
  "description": "Immune support supplement",
  "price": "19.99",
  "amount": 100,
  "category": 1,
  "is_available": true,
  "demand": "high",
  "image_url": "https://example.com/vitamin-c.jpg"
}

Responses
- 201 Created -> new product created.
- 200 OK -> existing product updated.
- 400 Bad Request -> validation error.

4. Full Update Product
----------------------
Request
- Method: PUT
- URL: /api/products/products/<id>/
- Example: /api/products/products/1/

Body
All writable fields must be sent:
{
  "name": "Vitamin C 500mg",
  "description": "Updated description",
  "price": "21.99",
  "amount": 80,
  "category": 1,
  "is_available": true,
  "demand": "medium",
  "image_url": "https://example.com/vitamin-c-new.jpg"
}

Responses
- 200 OK on success.
- 400 Bad Request for validation issues.
- 404 Not Found if the product does not exist.

5. Partial Update Product
-------------------------
Request
- Method: PATCH
- URL: /api/products/products/<id>/
- Example: /api/products/products/1/

Body
Only the fields to change:
{
  "price": "17.99",
  "amount": 120
}

Responses
- 200 OK on success.
- 400 Bad Request for validation issues.
- 404 Not Found if the product does not exist.

6. Delete Product
-----------------
Request
- Method: DELETE
- URL: /api/products/products/<id>/
- Example: /api/products/products/1/

Responses
- 204 No Content on success.
- 404 Not Found if the product does not exist.

Permissions
-----------
All actions are protected by DRF IsAdminUser:

- Allowed:
  - Authenticated users with is_staff = True.
- Denied:
  - Anonymous users.
  - Authenticated non-admin users.

Non-admins receive:
- 403 Forbidden

Summary
-------
- Admins can fully manage products (list, create, upsert, update, delete).
- Non-admins cannot access any product endpoints.
- The POST endpoint is idempotent by (name, category) to prevent duplicates and simplify admin workflows.


Patient & Treatment API (Admin-Only)
====================================

Overview
--------
The Patient API manages basic patient information and treatments/visits.

- Framework: Django REST Framework
- Base URLs:
  - Patients: /api/patient/patients/
  - Treatments: /api/patient/treatments/
- Access: Admin users only
- Models: patient.models.Patient, patient.models.Treatment

Only authenticated users with is_staff = True can access these endpoints.
Non-admin users receive 403 Forbidden.

Patient Data Model
------------------
Each patient has the following fields (as exposed by the API):

- id (read-only, integer)
- first_name (string, required)
- last_name (string, required)
- date_of_birth (date, optional)
- phone (string, required, unique, used to recognize returning patients)
- email (string, optional)
- address (string, optional)
- created_at (read-only, datetime)
- updated_at (read-only, datetime)

Treatment Data Model
--------------------
Each treatment record belongs to a patient and has:

- id (read-only, integer)
- patient (integer, required when not using nested patient data)
- visit_date (read-only, datetime, auto)
- complaint (string, required)
- diagnosis (string, optional)
- treatment_plan (string, required, description of treatment/medications/advice)
- notes (string, optional)

Patient Endpoints
-----------------
Base path: /api/patient/patients/

1. List Patients
----------------
Request
- Method: GET
- URL: /api/patient/patients/

Access
- Admin only.

2. Retrieve a Single Patient
----------------------------
Request
- Method: GET
- URL: /api/patient/patients/<id>/
- Example: /api/patient/patients/1/

Access
- Admin only.

3. Create or Update (Upsert) Patient
------------------------------------
Phone number is used as the unique key to avoid duplicate patients.

- If a patient with the same phone does not exist
  -> a new patient is created (201 Created).
- If such a patient already exists
  -> that patient is updated with the submitted data (200 OK).

Request
- Method: POST
- URL: /api/patient/patients/

Request body
{
  "first_name": "John",
  "last_name": "Doe",
  "date_of_birth": "1990-05-10",
  "phone": "+1234567890",
  "email": "john@example.com",
  "address": "Lagos, Nigeria"
}

4. Full Update Patient
----------------------
Request
- Method: PUT
- URL: /api/patient/patients/<id>/
- Example: /api/patient/patients/1/

Body
All writable fields must be sent.

5. Partial Update Patient
-------------------------
Request
- Method: PATCH
- URL: /api/patient/patients/<id>/
- Example: /api/patient/patients/1/

Body
Only the fields to change.

6. Delete Patient
-----------------
Request
- Method: DELETE
- URL: /api/patient/patients/<id>/
- Example: /api/patient/patients/1/

Responses
- 204 No Content on success.
- 404 Not Found if the patient does not exist.

Treatment Endpoints
-------------------
Base path: /api/patient/treatments/

1. List Treatments
------------------
Request
- Method: GET
- URL: /api/patient/treatments/

2. Retrieve a Single Treatment
------------------------------
Request
- Method: GET
- URL: /api/patient/treatments/<id>/
- Example: /api/patient/treatments/1/

3. Create Treatment (Reuses Existing Patient When Possible)
-----------------------------------------------------------
This is the main workflow for recording visits.

- If nested patient data with a known phone is provided
  -> the existing patient with that phone is reused.
- If the phone is new
  -> a new patient is created first, then the treatment is linked to that patient.

Request
- Method: POST
- URL: /api/patient/treatments/

Example request body
{
  "patient": {
    "first_name": "John",
    "last_name": "Doe",
    "date_of_birth": "1990-05-10",
    "phone": "+1234567890",
    "email": "john@example.com",
    "address": "Lagos, Nigeria"
  },
  "complaint": "Headache and fever for 3 days",
  "diagnosis": "Malaria",
  "treatment_plan": "Antimalarial drugs + rest + hydration",
  "notes": "Follow-up in 3 days"
}

4. Update or Delete Treatment
-----------------------------
- Update (full): PUT /api/patient/treatments/<id>/
- Partial update: PATCH /api/patient/treatments/<id>/
- Delete: DELETE /api/patient/treatments/<id>/

Permissions for Patient & Treatment
-----------------------------------
All patient and treatment actions are protected by DRF IsAdminUser:

- Allowed:
  - Authenticated users with is_staff = True.
- Denied:
  - Anonymous users.
  - Authenticated non-admin users.

This means only admins can add, edit, update, and delete patient data
and treatment records.
